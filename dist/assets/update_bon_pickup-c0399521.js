import{t as m}from"./add_bon-0d655d19.js";import{h}from"./heading-f00730b6.js";import{S as r}from"./select-ab6ad5d3.js";import{b as d}from"./simple-2283d124.js";import{bB as _,aH as a,az as n,q as p,r as i,z as l,a_ as b,o as u,p as c,F as g,bK as y,bI as v,bH as k,aD as w,aA as C}from"./index-3afa6c13.js";import{T as f}from"./eticket-5e32969c.js";const D=t=>(w("data-v-89a24a97"),t=t(),C(),t),I={class:"main-content"},U={class:"page-content"},S={class:"container-fluid"},V={class:"row"},O={class:"col-md-8"},R={class:"col-md-4"},T={class:"card"},B={class:"card-body"},F={class:"row"},N={class:"col-md-12 mt-4"},P={key:0,class:"card"},q={class:"card-body"},$=D(()=>i("h5",null,"Telechergement",-1)),G={class:"row"},A={components:{table_add_bon:m,heading:h,SelectDropdown:r,button_simple:d,Tickets:f},data(){return{openDownload:!0,bonID:null,selectedOrders:a([]),selectedOrdersIds:a([]),test:a([]),bonID:this.$route.params.id,Client:null,Ref:null,filters:{customer:"",city:"",codecity:""},newUrl:null,query_search:"",city_filter:"?"}},methods:{async GenerateBon(){await y(this.bonID,"pickup","https://api.gestion-livraison.pro/api/bon/pickup/"+this.bonID+"/download/get")},async GenerateTickets(){await generateTicketsPdf(this.selectedOrders.map(t=>t.id))},search(t,e){this.query_search=this.constructApiUrlWithFilters(),t=="codecity"&&(e?(this.city_filter="?",this.city_filter+="codecity="+e):this.city_filter="?"),window.history.pushState({},"",this.newUrl)},constructApiUrlWithFilters(){const t=new URLSearchParams;for(const e in this.filters)this.filters[e]&&t.append(e,this.filters[e]);return this.newUrl=`${window.location.pathname}?${t.toString()}`,`?${t.toString()}`},async submitForm(){console.log(this.selectedOrders),console.log(this.filters.customer),console.log(this.selectedOrders.length);const t={customerId:this.Client,selectedRows:this.selectedOrders,colis:this.selectedOrders.length};await v(`https://api.gestion-livraison.pro/api/bon/pickup/${this.bonID}/update`,t)},handleTableData(t){console.log(t),this.selectedOrders=t,t&&(this.selectedOrdersIds=t.map(e=>e.id))}},async mounted(){const t=await k(`https://api.gestion-livraison.pro/api/bon/pickup/${this.bonID}/get`);this.Client=t.Client,this.Ref=t.Ref,this.$on("selectedOrders",e=>{this.selectedOrders=e,e&&(this.selectedOrdersIds=e.map(s=>s.id)),console.log("orders"),console.log(e)})}},z=Object.assign(A,{__name:"update_bon_pickup",setup(t){return a(null),a(null),(e,s)=>(n(),p(g,null,[i("div",I,[i("div",U,[i("div",S,[l(h,{pageTitle:"Modifier Bon de Ramassage"}),i("div",V,[i("div",O,[l(m,{apiUrl:"https://api.gestion-livraison.pro/api/bon/pickup/orders",onTableData:e.handleTableData,updateSelected:`https://api.gestion-livraison.pro/api/bon/pickup/details/${e.bonID}/get`,filters_update:e.query_search},null,8,["onTableData","updateSelected","filters_update"])]),i("div",R,[i("div",T,[i("div",B,[i("h5",null,"Bon de Ramassage #"+b(e.Ref),1),i("div",F,[e.Role!="customer"&&e.Role!="deliveryman"?(n(),u(r,{key:0,apiUrl:"https://api.gestion-livraison.pro/api/customers?per_page=200",fieldName:"Nom",first_option:"Selectionner un Client",label:"Filtrer Par Client",Class_Content:"col-md-12 mt-4",modelValue:e.filters.customer,"onUpdate:modelValue":s[0]||(s[0]=o=>e.filters.customer=o),value:e.filters.customer,"onUpdate:value":s[1]||(s[1]=o=>{e.filters.customer=o,e.search("customer",o)})},null,8,["modelValue","value"])):c("",!0),e.Role!="customer"&&e.Role!="deliveryman"?(n(),u(r,{key:1,apiUrl:"https://api.gestion-livraison.pro/api/cities/codes?per_page=200",fieldName:"Nom",first_option:"Selectionner un Code",label:"Filtrer Par Code Villes",Class_Content:"col-md-12 mt-4",modelValue:e.filters.codecity,"onUpdate:modelValue":s[2]||(s[2]=o=>e.filters.codecity=o),value:e.filters.codecity,"onUpdate:value":s[3]||(s[3]=o=>{e.filters.codecity=o,e.search("codecity",o)})},null,8,["modelValue","value"])):c("",!0),l(r,{apiUrl:`https://api.gestion-livraison.pro/api/cities${e.city_filter}?per_page=200`,fieldName:"Nom",first_option:"Selectionner une Ville",label:"Filtrer Par Ville",Class_Content:"col-md-12 mt-4",modelValue:e.filters.city,"onUpdate:modelValue":s[4]||(s[4]=o=>e.filters.city=o),value:e.filters.city,"onUpdate:value":s[5]||(s[5]=o=>{e.filters.city=o,e.search("city",o)})},null,8,["apiUrl","modelValue","value"]),i("div",N,[l(d,{onClick:e.submitForm,Class_Content:"col-md-12 mt-4",btn_text:"Modifier Bon de Ramassage"},null,8,["onClick"])])])])]),e.openDownload?(n(),p("div",P,[i("div",q,[$,i("div",G,[l(d,{onClick:e.GenerateBon,Class_Content:"col-md-12 mt-4",btn_text:"Telecharger le bon",icon:"fas fa-download"},null,8,["onClick"]),l(d,{"data-bs-toggle":"modal","data-bs-target":"#Tickets",Class_Content:"col-md-12 mt-4",btn_text:"Telecharger les E-tickets",icon:"fas fa-download"})])])])):c("",!0)])])])])]),l(f,{ordersId:e.selectedOrdersIds},null,8,["ordersId"])],64))}}),L=_(z,[["__scopeId","data-v-89a24a97"]]);export{L as default};
