import{bB as m,bD as V,bI as C,bL as w,bK as x,bM as S,bJ as R,aM as g,az as o,q as l,r as i,F as _,aK as u,a_ as c,y as F,o as b,p as h,aj as k,bs as D,bu as U,bi as P,z as q,aD as B,aA as N,x as j}from"./index-3afa6c13.js";import{c as I}from"./check-fe9a82f7.js";import{S as M}from"./delete-6aebbd9b.js";const A={components:{checkd:I,Supprimer:M},props:{apiUrl:{type:String,required:!0},api_name_middle:{type:String,required:!0},validation_role:{type:String,required:!0},keyword:{type:String,required:!0},filters_update:{type:String,required:!0}},data(){return{pagination:[],filters:"",pagination_filters:"",per_page:10,page:1,bon:{Valid:""},tableFields:[],data:[],delete_row_id:"",deletedRow:"",loading:!1,Role:V()}},methods:{loadPage(t){this.page=t;let s;this.filters?s=this.filters+"&page="+this.page+"&per_page="+this.per_page:s="?page="+this.page+"&per_page="+this.per_page,this.getFetchData(s)},pageCount(){let t;this.filters?t=this.filters+"&page="+this.page+"&per_page="+this.per_page:t="?page="+this.page+"&per_page="+this.per_page,this.getFetchData(t),console.log(t)},async toggleValid(t){t.Valid=t.Valid===1?0:1,await C(`https://api.gestion-livraison.pro/api/bon/${t.id}/${this.$props.api_name_middle}/valid/update`,{Valid:t.Valid})},checkModule(t){const s=w(t);return console.log(s),s},async GenerateBon(t){this.$props.keyword==="delivery"||this.$props.keyword==="customerreturn"?await x(t,this.$props.keyword,"https://api.gestion-livraison.pro/api/bon/"+this.$props.keyword+"/"+t+"/download/get"):await S(t,this.$props.keyword,"https://api.gestion-livraison.pro/api/bon/"+this.$props.keyword+"/"+t+"/download/get")},async getFetchData(t=null){this.loading=!0;const s=await R(this.apiUrl+t);this.data=s.data,this.pagination=s.pagination,this.data.length>0&&(this.tableFields=Object.keys(s.data[0]),this.tableFields=this.tableFields.filter(p=>!["id","Valid","Valide","Colis"].includes(p))),this.loading=!1}},mounted(){this.$emit("selectedOrders",this.selectedOrders),this.getFetchData("")},watch:{filters_update(t){this.page=1,this.filters=t,this.getFetchData(t)},deletedRow(t){const s=this.data.findIndex(p=>p.id===parseInt(t));s!==-1&&this.data.splice(s,1)}}},d=t=>(B("data-v-0cd32700"),t=t(),N(),t),G={key:0,class:"table-responsive"},O={class:"table table-bordered"},z={class:"bg-light"},K=d(()=>i("th",null,"Valide/Colis",-1)),L=d(()=>i("th",null,"Validation",-1)),E=d(()=>i("th",null,"Action",-1)),J={class:"header_side"},T=d(()=>i("span",{class:"header_side"},"Valide/Colis : ",-1)),H={key:0},Q={key:1},W=d(()=>i("span",{class:"header_side"},"Validation : ",-1)),X={class:"table_actions"},Y={class:"d-flex align-items-center order-actions"},Z=["onClick"],$=d(()=>i("i",{class:"fas fa-file-invoice"},null,-1)),ee=[$],te=d(()=>i("i",{class:"fas fa-pencil-alt"},null,-1)),se=["onClick"],ae=d(()=>i("i",{class:"fas fa-trash-alt"},null,-1)),ie=[ae],oe={class:"row d-flex justify-content-between align-items-center"},le={class:"col-md-1"},ne=j('<option value="10" data-v-0cd32700>10</option><option value="20" data-v-0cd32700>20</option><option value="50" data-v-0cd32700>50</option><option value="100" data-v-0cd32700>100</option><option value="200" data-v-0cd32700>200</option><option value="500" data-v-0cd32700>500</option><option value="1000" data-v-0cd32700>1000</option>',7),de=[ne],re={class:"col-md-6 d-flex justify-content-end align-items-center"},ce={class:"pagination d-flex align-items-end"},pe={key:0,class:"page-item"},_e=["onClick"],he={key:1,class:"page-item"},ue={key:1,class:"d-flex justify-content-center py-4 bg-light"},ge=d(()=>i("span",{class:"loader"},null,-1)),be=[ge],ve={key:2,class:"p-3 text-center bg-light"},ke=d(()=>i("p",null,"no-data",-1)),fe=[ke],ye=d(()=>i("div",{class:"mx-2 m-3 pb-3 pt-3"},null,-1));function me(t,s,p,Ve,a,r){const v=g("checkd"),f=g("router-link"),y=g("Supprimer");return o(),l(_,null,[a.data.length>0?(o(),l("div",G,[i("table",O,[i("thead",z,[i("tr",null,[(o(!0),l(_,null,u(a.tableFields,e=>(o(),l("th",{key:e},c(e),1))),128)),K,L,E])]),i("tbody",null,[(o(!0),l(_,null,u(a.data,e=>(o(),l("tr",{key:e.id},[(o(!0),l(_,null,u(a.tableFields,n=>(o(),l("td",{key:n},[i("span",J,c(n)+" : ",1),F(" "+c(e[n]),1)]))),128)),i("td",null,[T,e.Colis!=null?(o(),l("div",H,c(e.Valide+"/"+e.Colis),1)):(o(),l("div",Q,"Counred"))]),i("td",null,[W,a.Role=="deliveryman"&&e.Valid===0?(o(),b(v,{key:0,modelValue:a.bon.Valid,"onUpdate:modelValue":s[0]||(s[0]=n=>a.bon.Valid=n),value:a.bon.Valid,Class_Content:"",id_check:`bon-${e.Ref}`,is_checked:e.Valid,checked:e.Valid===1,"onUpdate:value":s[1]||(s[1]=n=>t.formData.Valid=n),onChange:n=>r.toggleValid(e)},null,8,["modelValue","value","id_check","is_checked","checked","onChange"])):h("",!0),r.checkModule(this.$props.validation_role)&&a.Role!="deliveryman"?(o(),b(v,{key:1,modelValue:a.bon.Valid,"onUpdate:modelValue":s[2]||(s[2]=n=>a.bon.Valid=n),value:a.bon.Valid,Class_Content:"",id_check:`bon-${e.Ref}`,is_checked:e.Valid,checked:e.Valid===1,"onUpdate:value":s[3]||(s[3]=n=>t.formData.Valid=n),onChange:n=>r.toggleValid(e)},null,8,["modelValue","value","id_check","is_checked","checked","onChange"])):(o(),l("div",{key:2,class:k(`badge badge-success ${e.Valid===1?"bg-success ":"bg-danger "}`)},c(e.Valid===1?"Oui":"Non"),3))]),i("td",X,[i("div",Y,[i("button",{onClick:n=>r.GenerateBon(e.id),type:"button",class:"btn bg-light btn-sm waves-effect mx-1"},ee,8,Z),a.Role!="deliveryman"&&a.Role=="Admin"||e.Valid!=1?(o(),b(f,{key:0,to:`/bon/${e.id}/${this.$props.api_name_middle}/update`,class:"btn bg-light btn-sm waves-effect mx-1"},{default:D(()=>[te]),_:2},1032,["to"])):h("",!0),a.Role!="deliveryman"&&a.Role=="Admin"||e.Valid!=1?(o(),l("button",{key:1,type:"button",class:"btn bg-light btn-sm waves-effect mx-1",onClick:n=>{a.delete_row_id=e.id},"data-bs-toggle":"modal","data-bs-target":"#DeleteRow"},ie,8,se)):h("",!0)])])]))),128))])]),i("div",oe,[i("div",le,[U(i("select",{class:"form-control","onUpdate:modelValue":s[4]||(s[4]=e=>a.per_page=e),onChange:s[5]||(s[5]=(...e)=>r.pageCount&&r.pageCount(...e))},de,544),[[P,a.per_page]])]),i("nav",re,[i("ul",ce,[a.pagination.current_page>1?(o(),l("li",pe,[i("a",{class:"page-link",href:"#",onClick:s[6]||(s[6]=e=>r.loadPage(a.pagination.current_page-1))},"Précédent")])):h("",!0),(o(!0),l(_,null,u(a.pagination.last_page,e=>(o(),l("li",{class:k(["page-item",{active:e===a.pagination.current_page}]),key:e},[i("a",{class:"page-link",href:"#",onClick:n=>r.loadPage(e)},c(e),9,_e)],2))),128)),a.pagination.current_page<a.pagination.last_page?(o(),l("li",he,[i("a",{class:"page-link",href:"#",onClick:s[7]||(s[7]=e=>r.loadPage(a.pagination.current_page+1))},"Suivant")])):h("",!0)])])])])):a.loading?(o(),l("div",ue,be)):(o(),l("div",ve,fe)),q(y,{apiUrl:`https://api.gestion-livraison.pro/api/bon/${p.api_name_middle}/${a.delete_row_id}/delete`,onDeletedId:s[8]||(s[8]=e=>a.deletedRow=e)},null,8,["apiUrl"]),ye],64)}const Se=m(A,[["render",me],["__scopeId","data-v-0cd32700"]]);export{Se as b};
