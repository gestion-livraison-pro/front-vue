import{t as m}from"./add_bon-0d655d19.js";import{h}from"./heading-f00730b6.js";import{S as r}from"./select-ab6ad5d3.js";import{b as n}from"./simple-2283d124.js";import{bB as b,az as a,q as p,r as o,z as l,o as u,p as d,F as y,bD as g,aH as c,bK as v,bG as w,aD as k,aA as C}from"./index-3afa6c13.js";import{T as f}from"./eticket-5e32969c.js";const _=t=>(k("data-v-60b8c5a3"),t=t(),C(),t),D={class:"main-content"},U={class:"page-content"},I={class:"container-fluid"},V={class:"row"},O={class:"col-md-8"},S={class:"col-md-4"},T={class:"card"},B={class:"card-body"},N=_(()=>o("h5",null,"Bon de livraison",-1)),F={class:"row"},R={class:"col-md-12 mt-4"},P={key:0,class:"card"},q={class:"card-body"},G=_(()=>o("h5",null,"Telechergement",-1)),A={class:"row"},j={components:{table_add_bon:m,heading:h,SelectDropdown:r,button_simple:n,Tickets:f},data(){return{openDownload:!1,bonID:null,Role:g(),selectedOrders:c([]),selectedOrdersIds:c([]),test:c([]),filters:{customer:"",city:"",codecity:""},newUrl:null,query_search:"",city_filter:"?"}},methods:{async GenerateBon(){await v(this.bonID,"pickup","https://api.gestion-livraison.pro/api/bon/pickup/"+this.bonID+"/download/get")},async GenerateTickets(){await generateTicketsPdf(this.selectedOrders.map(t=>t.id))},search(t,e){this.query_search=this.constructApiUrlWithFilters(),t=="codecity"&&(e?(this.city_filter="?",this.city_filter+="codecity="+e):this.city_filter="?"),window.history.pushState({},"",this.newUrl)},constructApiUrlWithFilters(){const t=new URLSearchParams;for(const e in this.filters)this.filters[e]&&t.append(e,this.filters[e]);return this.newUrl=`${window.location.pathname}?${t.toString()}`,`?${t.toString()}`},async submitForm(){console.log(this.selectedOrders),console.log(this.Customer);const t={customerId:this.filters.customer,selectedRows:this.selectedOrders,colis:this.selectedOrders.length},e=await w("https://api.gestion-livraison.pro/api/bon/pickup/new",t);e.data.id&&(this.bonID=e.data.id,this.openDownload=!0)},handleTableData(t){console.log(t),this.selectedOrders=t,t&&(this.selectedOrdersIds=t.map(e=>e.id))}},onMounted(){this.$route.params.id,this.$on("selectedOrders",t=>{this.selectedOrders=t,t&&(this.selectedOrdersIds=t.map(e=>e.id)),console.log("orders"),console.log(t)})}},z=Object.assign(j,{__name:"add_bon_pickup",setup(t){return(e,i)=>(a(),p(y,null,[o("div",D,[o("div",U,[o("div",I,[l(h,{pageTitle:"Nouveau Bon de Ramassage"}),o("div",V,[o("div",O,[l(m,{apiUrl:"https://api.gestion-livraison.pro/api/bon/pickup/orders",onTableData:e.handleTableData,"update-bon":e.bon_pickup,filters_update:e.query_search},null,8,["onTableData","update-bon","filters_update"])]),o("div",S,[o("div",T,[o("div",B,[N,o("div",F,[e.Role!="customer"&&e.Role!="deliveryman"?(a(),u(r,{key:0,apiUrl:"https://api.gestion-livraison.pro/api/customers?per_page=200",fieldName:"Nom",first_option:"Selectionner un Client",label:"Filtrer Par Client",Class_Content:"col-md-12 mt-4",modelValue:e.filters.customer,"onUpdate:modelValue":i[0]||(i[0]=s=>e.filters.customer=s),value:e.filters.customer,"onUpdate:value":i[1]||(i[1]=s=>{e.filters.customer=s,e.search("customer",s)})},null,8,["modelValue","value"])):d("",!0),e.Role!="customer"&&e.Role!="deliveryman"?(a(),u(r,{key:1,apiUrl:"https://api.gestion-livraison.pro/api/cities/codes?per_page=200",fieldName:"Nom",first_option:"Selectionner un Code",label:"Filtrer Par Code Villes",Class_Content:"col-md-12 mt-4",modelValue:e.filters.codecity,"onUpdate:modelValue":i[2]||(i[2]=s=>e.filters.codecity=s),value:e.filters.codecity,"onUpdate:value":i[3]||(i[3]=s=>{e.filters.codecity=s,e.search("codecity",s)})},null,8,["modelValue","value"])):d("",!0),l(r,{apiUrl:`https://api.gestion-livraison.pro/api/cities${e.city_filter}?per_page=200`,fieldName:"Nom",first_option:"Selectionner une Ville",label:"Filtrer Par Ville",Class_Content:"col-md-12 mt-4",modelValue:e.filters.city,"onUpdate:modelValue":i[4]||(i[4]=s=>e.filters.city=s),value:e.filters.city,"onUpdate:value":i[5]||(i[5]=s=>{e.filters.city=s,e.search("city",s)})},null,8,["apiUrl","modelValue","value"]),o("div",R,[l(n,{onClick:e.submitForm,CClass_Content:"col-md-12 mt-4",btn_text:"Ajouter Bon de livraison"},null,8,["onClick"])])])])]),e.openDownload?(a(),p("div",P,[o("div",q,[G,o("div",A,[l(n,{onClick:e.GenerateBon,Class_Content:"col-md-12 mt-4",btn_text:"Telecharger le bon",icon:"fas fa-download"},null,8,["onClick"]),l(n,{"data-bs-toggle":"modal","data-bs-target":"#Tickets",Class_Content:"col-md-12 mt-4",btn_text:"Telecharger les E-tickets",icon:"fas fa-download"})])])])):d("",!0)])])])])]),l(f,{ordersId:e.selectedOrdersIds},null,8,["ordersId"])],64))}}),M=b(z,[["__scopeId","data-v-60b8c5a3"]]);export{M as default};
