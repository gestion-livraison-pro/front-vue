import{bB as g,bD as x,aH as m,as as $,bC as v,az as n,q as a,r as e,F as y,aK as b,aj as D,y as u,a_ as d,p as f,aD as C,aA as w,bG as k,aM as I,z as p}from"./index-3afa6c13.js";import{i as S}from"./input-e668dea8.js";import{b as M}from"./simple-2283d124.js";import{h as F}from"./heading-f00730b6.js";import{f as T}from"./search-e618f654.js";import"./select-ab6ad5d3.js";import"./defineProperty-b185edd1.js";const j={data(){return{Role:x(),conversations:"",selectConvID:""}},props:{filters_update:{type:String,required:!0}},setup(s,{emit:i}){console.log("response");const c=m([]),_=m(null);return $(async()=>{const t=await v("https://api.gestion-livraison.pro/api/conversations");console.log(t),t.length>0&&(c.value=t,console.log(c.value))}),{conversations:c,selectConv:t=>{console.log(t),i("select_conversation",t),console.log(t),_.value=t.id},selectConvID:_}},methods:{async getFetchData(s=null){this.conversations=await v("https://api.gestion-livraison.pro/api/conversations"+s)},selectConv(s){this.$emit("select_conversation",s),console.log(s),this.selectConvID=s.id}},mounted(){this.getFetchData("")},watch:{filters_update(s){alert(s),this.filters=s,this.getFetchData(s)}}},R=s=>(C("data-v-1a7f51d0"),s=s(),w(),s),V={class:"card col-md-4 p-3",style:{"box-shadow":"rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 1px 3px 1px"}},B={class:"list-unstyled overflow-scroll conversations-side"},N=["onClick"],U={class:"row d-flex justify-content-between align-items-center"},q={class:"col-md-9 d-flex flex-row align-items-center overflow-scroll"},z=R(()=>e("img",{src:"https://via.placeholder.com/70",alt:"",class:"rounded-circle col-1 col-md-2"},null,-1)),L={class:"m-3"},O={key:0},A={class:"fw-bold mb-0"},H={class:"fw-bold mb-0"},E={class:"fw-bold mb-0"},G={class:"col-md-3 d-flex justify-content-end align-items-end flex-column text-end"},K={class:"small text-muted"},J={key:0,class:"badge",style:{background:"#FF8C00"}};function P(s,i,c,_,l,t){return n(),a("div",V,[e("ul",B,[(n(!0),a(y,null,b(_.conversations,r=>(n(),a("li",{class:D(["card border-bottom p-3",{active:r.id===_.selectConvID}]),key:r.id,style:{cursor:"pointer"},onClick:o=>t.selectConv(r)},[e("div",U,[e("div",q,[z,e("div",L,[l.Role!="customer"?(n(),a("div",O,[e("p",A,[u("Client : "),e("span",null,d(r.Client),1)]),e("p",H,[u("Livreur : "),e("span",null,d(r.Livreur),1)])])):f("",!0),e("strong",E,[u("Commande: : "),e("span",null,d(r.CommandeRef),1)])])]),e("div",G,[e("p",K,d(new Date(r.Date).toISOString().split("T")[0]),1),r.notification_count?(n(),a("span",J,d(r.notification_count),1)):f("",!0)])])],10,N))),128))])])}const Q=g(j,[["render",P],["__scopeId","data-v-1a7f51d0"]]);const W={props:{conv:{type:Array,required:!0}},components:{input_text:S,button_simple:M},data(){return{formData:{Message:"",ConversationId:null},messages:[],Role:x()}},async mounted(){await this.displayMessages(),this.$route.params.id&&(this.formData.ConversationId=this.$route.params.conversation)},methods:{async submitForm(){const s=await k("https://api.gestion-livraison.pro/api/message/new",this.formData);console.log(s),this.messages.push(s.message),this.formData.Message=""},async displayMessages(){if(this.conv.id){const s=await v(`https://api.gestion-livraison.pro/api/messages/${this.conv.id}`);this.messages=s,scrollToBottom()}},scrollToBottom(){const s=this.$refs.messagesContainer;s.scrollTop=s.scrollHeight}},watch:{conv:{immediate:!0,async handler(){this.formData.ConversationId=this.conv.id,await this.displayMessages()}}}},h=s=>(C("data-v-ef88f215"),s=s(),w(),s),X={class:"col-md-8 card p-3",style:{"box-shadow":"rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 1px 3px 1px"}},Y={key:0},Z={class:"card"},ee={key:0,class:"card-body d-flex justify-content-between align-items-center"},se={key:1,class:"card-body d-flex justify-content-between align-items-center"},te={class:"d-flex flex-column overflow-scroll messages-side",ref:"messagesContainer"},oe={key:0,class:"d-flex flex-row align-items-center"},ne=h(()=>e("img",{src:"https://via.placeholder.com/60",alt:"",class:"rounded-circle align-self-center mx-3 col-1"},null,-1)),ae={class:"bg-light p-2"},ie={class:"small text-muted text-end"},le={key:1,class:"d-flex flex-row justify-content-end"},ce=h(()=>e("img",{src:"https://via.placeholder.com/60",alt:"",class:"rounded-circle align-self-center mx-3 col-1"},null,-1)),re={class:"bg-primary text-light p-2"},de={class:"small text-muted text-end"},_e={class:"card p-4 m-0"},pe={class:"ard-body row d-flex align-items-center"},ue={class:"col-md-2"},me=h(()=>e("i",{class:"far fa-paper-plane"},null,-1)),he={key:1,class:"d-flex align-items-center justify-content-center"},ve=h(()=>e("h3",{class:"color-grey"},"aucun conversation selectionne",-1)),fe=[ve];function ge(s,i,c,_,l,t){const r=I("input_text");return n(),a("div",X,[c.conv?(n(),a("div",Y,[e("div",Z,[l.Role!="customer"?(n(),a("div",ee,[e("h6",null,d(c.conv.Client),1)])):(n(),a("div",se,[e("h6",null,"Commande N: "+d(c.conv.Commande),1)]))]),e("div",te,[(n(!0),a(y,null,b(l.messages,o=>(n(),a("div",{class:"p-2",key:o.id},[o.si_client?(n(),a("div",oe,[ne,e("div",null,[e("div",ae,d(o.Contenu),1),e("p",ie,d(new Date(o.Date).toISOString().split("T")[0]+" | "+o.Utilisateur),1)])])):(n(),a("div",le,[ce,e("div",null,[e("div",re,d(o.Contenu),1),e("p",de,d(new Date(o.Date).toISOString().split("T")[0]+" | "+o.Utilisateur),1)])]))]))),128))],512),e("div",_e,[e("div",pe,[p(r,{modelValue:s.Message,"onUpdate:modelValue":i[0]||(i[0]=o=>s.Message=o),type:"text",Class_Content:"col-md-10 my-2",value:l.formData.Message,"onUpdate:value":i[1]||(i[1]=o=>l.formData.Message=o)},null,8,["modelValue","value"]),e("div",ue,[e("button",{class:"btn btn-primary w-100 my-2",onClick:i[2]||(i[2]=(...o)=>t.submitForm&&t.submitForm(...o))},[u("Sent "),me])])])])])):(n(),a("div",he,fe))])}const xe=g(W,[["render",ge],["__scopeId","data-v-ef88f215"]]),ye={class:"main-content"},be={class:"page-content"},Ce={class:"container-fluid"},we={class:"card"},$e={class:"card-body"},De={class:"mb-3"},ke={class:"row w-100 shadow h-100"},Ve={__name:"conversation",setup(s){const i=m(null),c=m(null);return(_,l)=>(n(),a("div",ye,[e("div",be,[e("div",Ce,[p(F,{pageTitle:"Messages"}),e("div",we,[e("div",$e,[e("div",De,[p(T,{placeholder:"Rechercher par Motcle",onFilterUpdated:l[0]||(l[0]=t=>i.value=t),filters_fields:"search,customer,date"})]),e("div",ke,[p(Q,{onSelect_conversation:l[1]||(l[1]=t=>c.value=t),filters_update:i.value},null,8,["filters_update"]),p(xe,{conv:c.value},null,8,["conv"])])])])])])]))}};export{Ve as default};
